<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <f:metadata>  
        <f:viewParam name="idSinistre" value="#{ficheSinistreMB.idSinistre}"  
                     /> 
        <f:viewAction action="#{ficheSinistreMB.initData()}"/>  
    </f:metadata>

    <body>
        <ui:composition template="./../../../WEB-INF/template-front/md-template.xhtml">
            <h:outputScript name="jsf.js" library="javax.faces" target="head" />

            <ui:define name="content">
                <div class="android-more-section">
                    <div class="mdl-grid">
                        
                        
                        <div class="mdl-cell mdl-cell--3-col" style="left: auto; max-height: 158px; position: relative; top: 0px;">
                            <nav class="devsite-section-nav devsite-nav nocontent" >
                                <ul class="demo-list-icon mdl-list">
                                    <li class="mdl-list__item">
                                        <span class="mdl-list__item-primary-content">
                                            <h:link class="mdl-navigation__link" outcome="/JSF/Produit/auto-moto/depot.xhtml?idContrat=#{ficheSinistreMB.sinistre.souscriptionProduitId.id}"  includeViewParams="true">Informations sur le contrat</h:link>
                                        </span>
                                    </li>

                                    <li class="mdl-list__item">
                                        <span class="mdl-list__item-primary-content">
                                            <h:link class="mdl-navigation__link" outcome="/JSF/Produit/auto-moto/listeSinistres.xhtml?idSouscription=#{ficheSinistreMB.sinistre.souscriptionProduitId.id}" includeViewParams="true" value="">Sinistres</h:link>
                                        </span>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                        
                        <div class="mdl-cell mdl-cell--9-col">
                            <h4>Accident sur le véhicule #{ficheSinistreMB.vehicule.noimm}</h4>
                            <h:panelGroup id="etat">
                                <span class="mdl-chip">
                                    <span class="mdl-chip__text">#{ficheSinistreMB.etat}</span>
                                </span>
                                
                            </h:panelGroup>

                            <p>Catégorie : #{ficheSinistreMB.sinistre.categorie.libelle}</p>
                            <p>Date : #{ficheSinistreMB.util.dateToString(ficheSinistreMB.sinistre.daty)} - #{ficheSinistreMB.sinistre.heure}</p>
                            <p>Lieu : #{ficheSinistreMB.sinistre.lieu}</p>

                            <div class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect">
                                <div class="mdl-tabs__tab-bar">
                                    <a href="#conducteur-panel" class="mdl-tabs__tab is-active"><span data-badge="">Conducteur</span></a>
                                    <a href="#dommages-panel" class="mdl-tabs__tab"><span class="#{ficheSinistreMB.classDommage}" data-badge="">Dommages</span></a>
                                    <a href="#circonstance-panel" class="mdl-tabs__tab"><span class="#{ficheSinistreMB.classCirconstance}" data-badge="">Circonstance</span></a>
                                    <a href="#photos-panel" class="mdl-tabs__tab"><span class="#{ficheSinistreMB.classPhotos}" data-badge="">Photos</span></a>
                                    <a href="#rapports-panel" class="mdl-tabs__tab">Rapports</a>
                                </div>

                                <div class="mdl-tabs__panel is-active" id="conducteur-panel">
                                    <div class="mdl-grid">
                                        <div class="mdl-cell mdl-cell--4-col">
                                            <p>Conducteur : </p>
                                            <p>Nom : </p>
                                            <p>Prénom : </p>
                                            <p>Date de naissance : </p>
                                            <p>Adresse : </p>

                                        </div>
                                        <div class="mdl-cell mdl-cell--8-col">
                                            <p>#{ficheSinistreMB.sinistre.conducteur}</p>
                                            <p>#{ficheSinistreMB.sinistre.nomConducteur}</p>
                                            <p>#{ficheSinistreMB.sinistre.prenomConducteur}</p>
                                            <p>#{ficheSinistreMB.util.dateToString(ficheSinistreMB.sinistre.dnConducteur)}</p>
                                            <p>#{ficheSinistreMB.sinistre.adresseConducteur}</p>
                                        </div>
                                    </div>                                    
                                    <h6>Permis</h6>
                                    <div class="mdl-grid">

                                        <div class="mdl-cell mdl-cell--4-col">
                                            <p>N° #{ficheSinistreMB.sinistre.nopermis} </p>
                                            <p>Catégorie #{ficheSinistreMB.sinistre.catPermis}</p>
                                            <p>Validé du : #{ficheSinistreMB.util.dateToString(ficheSinistreMB.sinistre.debValidite)}</p>
                                            <p>Date de délivrance : </p>
                                            <p>Lieu de délivrance : </p>
                                        </div>
                                        <div class="mdl-cell mdl-cell--8-col">
                                            <p>Duplicata N° #{ficheSinistreMB.sinistre.noduplicata}</p>
                                            <p>Cat. validées #{ficheSinistreMB.sinistre.catValidees}</p>
                                            <p>au : #{ficheSinistreMB.util.dateToString(ficheSinistreMB.sinistre.finValidite)}</p>
                                            <p>#{ficheSinistreMB.util.dateToString(ficheSinistreMB.sinistre.dateDelivrance)}</p>
                                            <p>#{ficheSinistreMB.sinistre.lieuDelivrance}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="mdl-tabs__panel" id="dommages-panel"> 

                                    <h:form>
                                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
                                            <label class="mdl-textfield__label" for="categorie">Categorie:</label>
                                            <h:selectOneMenu id="categorie" class="mdl-textfield__input"  value="#{ficheSinistreMB.dommageSelected}" title="Dommage"
                                                             converter="#{ficheSinistreMB.dommageConverter}">
                                                <f:selectItems value="#{ficheSinistreMB.listeAmDommages}" 
                                                               var="dommageSinistre"
                                                               itemValue="#{dommageSinistre}"
                                                               itemLabel="#{dommageSinistre.libelle}"/>
                                            </h:selectOneMenu>
                                        </div>
                                        <h:commandButton
                                            class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
                                            action="#{ficheSinistreMB.ajouterDommage(ficheSinistreMB.idSinistre)}"
                                            value="Ajouter">
                                            <f:ajax execute="@form" render=":list-dommages-parent :etat"></f:ajax>
                                        </h:commandButton>
                                    </h:form>
                                    <f:view>
                                        <h:panelGroup id="list-dommages-parent" >
                                            <h:panelGroup id="list-dommages">
                                                <ui:include src="/JSF/Produit/auto-moto/listeDommagesSinistre.xhtml"></ui:include>
                                            </h:panelGroup>
                                        </h:panelGroup>
                                    </f:view>


                                </div>

                                <!--circonstances du sinistre-->
                                <div class="mdl-tabs__panel" id="circonstance-panel">
                                    <f:view>
                                        <h:panelGroup>
                                            <h:panelGroup id="edit">
                                                <h:form>
                                                    <div class="mdl-textfield mdl-js-textfield">

                                                        <h:inputTextarea class="mdl-textfield__input" rows="4" cols="20" id="circo" value="#{ficheSinistreMB.sinistre.details}"></h:inputTextarea>

                                                        <label class="mdl-textfield__label" for="circo">Circonstances</label>
                                                    </div>
                                                    <br></br>
                                                    <h:commandButton class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect"
                                                                     action="#{ficheSinistreMB.validEditCirconstance()}" value="Modifier">
                                                        <f:ajax execute="@form" render=":edit :etat"></f:ajax>
                                                    </h:commandButton>
                                                    <!--<h:messages></h:messages>-->
                                                </h:form>
                                            </h:panelGroup>
                                        </h:panelGroup>
                                    </f:view>

                                </div>

                                <!--rapports d'expertise-->
                                <div class="mdl-tabs__panel" id="rapports-panel">
                                    <h:dataTable value="#{ficheSinistreMB.rapports}" var="rapport">
                                        <h:column>
                                            <f:facet name="header">
                                                <h:outputText value="Contenu"/>
                                            </f:facet>
                                            <h:outputText value="#{rapport.description}"/>
                                        </h:column>
                                        <h:column>
                                            <f:facet name="header">
                                                <h:outputText value="Description"/>
                                            </f:facet>
                                            <h:outputText value="#{rapport.valeur}"/>
                                        </h:column>
                                    </h:dataTable>
                                </div>




                                <!--photos-->
                                <div class="mdl-tabs__panel" id="photos-panel">
                                    <h:form enctype="multipart/form-data">

                                        <p:fileUpload fileUploadListener="#{ficheSinistreMB.handleFileUpload}" 
                                                      mode="advanced" dragDropSupport="true"
                                                      update="messages" sizeLimit="1000000" allowTypes="/(\.|\/)(gif|jpe?g|png)$/" >
                                        </p:fileUpload>

                                        <p:growl id="messages" showDetail="true" />
                                    </h:form>
                                    <h:panelGroup id="list-photos">
                                        <h:panelGroup>
                                            <ui:repeat value="#{ficheSinistreMB.photos}" var="photo">
                                                <h:graphicImage value="/resources/photos_sinistre/#{photo.photo}"/>

                                            </ui:repeat>
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </ui:define>

        </ui:composition>

    </body>
</html>
